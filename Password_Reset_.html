<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Password Reset</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      background-color: #f0f2f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .reset-card {
      width: 100%;
      max-width: 450px;
      background-color: #fff;
      padding: 30px 25px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    h2 {
      font-weight: 600;
    }

    .otp-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .otp-group input {
      flex: 2;
    }

    .otp-group button {
      flex: 1;
    }

    .password-section {
      display: none;
      margin-top: 15px;
    }

    .password-section ul {
      padding-left: 20px;
      margin-top: 5px;
    }

    .btn-group-flex {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    @media (max-width: 576px) {
      .otp-group {
        flex-direction: column;
      }

      .btn-group-flex {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <div class="reset-card">
    <h2 class="text-center mb-4">Reset Password</h2>
    <form id="resetForm" onsubmit="event.preventDefault();">

      <div class="form-floating mb-3">
        <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
        <label for="email">Email address</label>
      </div>

      <div class="otp-group">
        <input type="tel" class="form-control" id="otp" placeholder="OTP" required>
        <button type="button" class="btn btn-outline-primary" onclick="sendOTP()">Get OTP</button>
      </div>

      <div class="password-section" id="passwordSection">
        <div class="form-floating mb-3">
          <input type="password" class="form-control" id="password" placeholder="Password" onkeyup="PasswordChecker()" required>
          <label for="password">New Password</label>
          <ul>
            <li id="onecapletter">Contains at least one Capital letter.</li>
            <li id="onesmletter">Contains at least one Small letter.</li>
            <li id="onenumber">Contains at least one number.</li>
            <li id="onespecialchar">Contains at least one special character.</li>
            <li id="totalchar">Minimum 8 characters long.</li>
          </ul>
        </div>

        <div class="form-floating mb-3">
          <input type="password" class="form-control" id="cpassword" placeholder="Confirm Password" required>
          <label for="cpassword">Confirm Password</label>
        </div>
      </div>

      <div class="btn-group-flex">
        <button type="reset" class="btn btn-outline-danger flex-grow-1">Cancel</button>
        <button type="button" class="btn btn-outline-success flex-grow-1" id="verifybtn" onclick="verifyOTP()">Verify</button>
        <button type="button" class="btn btn-outline-success flex-grow-1" id="resetbtn" onclick="resetpassword()" hidden>Reset</button>
      </div>
    </form>
  </div>

  <script>
    function PasswordChecker() {
      let password = document.getElementById("password").value;

      let lowercase_error = document.getElementById("onesmletter");
      let uppercase_error = document.getElementById("onecapletter");
      let numbers_error = document.getElementById("onenumber");
      let special_symbol_error = document.getElementById("onespecialchar");
      let length_error = document.getElementById("totalchar");

      if (password.length === 0) {
        [uppercase_error, lowercase_error, numbers_error, special_symbol_error, length_error].forEach(el => el.style.color = "red");
        return;
      }

      uppercase_error.style.color = /[A-Z]/.test(password) ? "green" : "red";
      lowercase_error.style.color = /[a-z]/.test(password) ? "green" : "red";
      numbers_error.style.color = /\d/.test(password) ? "green" : "red";
      special_symbol_error.style.color = /[@&#$%^&*]/.test(password) ? "green" : "red";
      length_error.style.color = password.length >= 8 ? "green" : "red";
    }

    async function sendOTP() {
      try {
        const res = await axios.post("https://loginpage-backend-6jdy.onrender.com/changePassword/sendotp", {
          Email: document.getElementById("email").value
        });
        alert(res.data.message);
      } catch (error) {
        alert(error.response?.data?.message || error.message);
      }
    }

    async function verifyOTP() {
      try {
        const res = await axios.post("https://loginpage-backend-6jdy.onrender.com/changePassword/verifyotp", {
          Email: document.getElementById("email").value,
          OTP: document.getElementById("otp").value
        });

        alert(res.data.message);
        document.getElementById("verifybtn").hidden = true;
        document.querySelector("#passwordSection").style.display = "block";
        document.getElementById("resetbtn").hidden = false;
        document.querySelector(".otp-group").hidden=true;


      } catch (error) {
        alert(error.response?.data?.message || error.message);
      }
    }

    async function resetpassword() {
      try {
        const res = await axios.patch("https://loginpage-backend-6jdy.onrender.com/changePassword/resetpassword", {
          Email: document.getElementById("email").value,
          Password: document.getElementById("password").value,
          ConfirmPassword: document.getElementById("cpassword").value
        });

        alert(res.data.message);
        window.location.href = "./index.html";
      } catch (error) {
        alert(error.response?.data?.message || error.message);
      }
    }
  </script>

</body>
</html>
